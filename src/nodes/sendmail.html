<script type="text/javascript">
  RED.nodes.registerType('sendmail',{
    category: 'network',
    color: '#FFF0F0',
    defaults: {
      username: {value: ""},
      apikey: {value: ""},
      to: {value: ""},
      subject: {value: ""},
      message: {value: ""},
      fromname: {value: ""},
      fromemail: {value: ""},
    },
    inputs: 1,
    outputs: 1,
    icon: "blastengine.png",
    label: function() {
      return this.name || "sendmail";
    },
    oneditprepare: function() {
      this.editor = RED.editor.createEditor({
        id: 'node-input-body',
        mode: 'ace/mode/text',
        value: this.message,
      });
    },
    oneditsave: function() {
      this.message = this.editor.getValue();
      this.editor.destroy();
      delete this.editor;
    },
    oneditcancel: function() {
      this.editor.destroy();
      delete this.editor;
    },
  });
</script>

<script type="text/html" data-template-name="sendmail">
  <div class="form-row">
    <label for="node-input-username"><i class="icon-tag"></i> User name</label>
    <input type="text" id="node-input-username" placeholder="User name">
  </div>
  <div class="form-row">
    <label for="node-input-apikey"><i class="icon-tag"></i> API Key</label>
    <input type="text" id="node-input-apikey" placeholder="API key">
  </div>
  <div class="form-row">
    <label for="node-input-to"><i class="icon-tag"></i> To</label>
    <input type="text" id="node-input-to" placeholder="user@example.com">
  </div>
  <div class="form-row">
    <label for="node-input-subject"><i class="icon-tag"></i> Subject</label>
    <input type="text" id="node-input-subject" placeholder="Subject">
  </div>
  <div class="form-row">
    <label for="node-input-fromname"><i class="icon-tag"></i> From name</label>
    <input type="text" id="node-input-fromname" placeholder="Node-Red Administrator">
  </div>
  <div class="form-row">
    <label for="node-input-fromemail"><i class="icon-tag"></i> From email</label>
    <input type="text" id="node-input-fromemail" placeholder="admin@example.com">
  </div>
  <div class="form-row">
    <label for="node-input-body"><i class="icon-tag"></i> Email body</label>
    <div
      style="height: 250px; min-height:150px;"
      class="node-text-editor"
      id="node-input-body"
    >
    </div>
  </div>
</script>

<script type="text/html" data-help-name="sendmail">
  <p>Send a email using blastengine.</p>
  <p>You can use those keywords in your email body.</p>
  <h5>If parameters are string or object.</h5>
  <ul>
    <li>__input__: Input value(s) from previous node.</li>
  </ul>
  <h5>If parameters are object.</h5>
  <ul>
    <li>__${key}__: Replace to object value.</li>
  </ul>
  <h5>Option parameters</h5>
  <ul>
    <li>subject: Email subject.</li>
    <li>to: Email address to send.</li>
    <li>fromname: From name.</li>
    <li>fromemail: From email address.</li>
    <li>cc: Email address to cc.</li>
    <li>bcc: Email address to bcc.</li>
  </ul>
</script>